{"remainingRequest":"/Users/nmadhab/hobby/social-network-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/nmadhab/hobby/social-network-frontend/src/views/ListFriends.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/nmadhab/hobby/social-network-frontend/src/views/ListFriends.vue","mtime":1618843800954},{"path":"/Users/nmadhab/hobby/social-network-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nmadhab/hobby/social-network-frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/nmadhab/hobby/social-network-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/nmadhab/hobby/social-network-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7QVBJX0JBU0VfVVJMfSBmcm9tICcvc3JjL2NvbmZpZy5qcyc7CmltcG9ydCBmaXJlYmFzZSBmcm9tICIuLi9maXJlYmFzZSI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkxpc3RGcmllbmRzIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXNlcnM6IFtdLAogICAgICBlbWFpbDogJycsCiAgICAgIHVzZXJuYW1lOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcm5hbWUnKSwKICAgICAgcmVmOiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignY2hhdHJvb21zLycpCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBsaXN0RnJpZW5kcygpewogICAgICBheGlvcy5nZXQoYCR7QVBJX0JBU0VfVVJMfXByaXZhdGUvbGlzdEZyaWVuZHNgLHsnaGVhZGVycycgOnsKICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnK2xvY2FsU3RvcmFnZS5nZXRJdGVtKCdpZFRva2VuJyksCiAgICAgICAgfX0pLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzcC5kYXRhKTsKICAgICAgICBpZihyZXNwLnN0YXR1cyA9PT0gMjAwKXsKICAgICAgICAgIHRoaXMudXNlcnMgPSByZXNwLmRhdGE7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSkKICAgIH0sCiAgICBmZXRjaFJvb20oaWQsIGZyaWVuZE5hbWUpIHsKICAgICAgY29uc29sZS5sb2coaWQpOwogICAgICBheGlvcy5nZXQoYCR7QVBJX0JBU0VfVVJMfXByaXZhdGUvZ2V0Um9vbU5hbWU/ZnJpZW5kSWQ9JHtpZH1gLCB7J2hlYWRlcnMnOnsKICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnK2xvY2FsU3RvcmFnZS5nZXRJdGVtKCdpZFRva2VuJyksCiAgICAgIH19KS50aGVuKHJlc3AgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3AuZGF0YSk7CiAgICAgICAgdGhpcy5yZWYub3JkZXJCeUNoaWxkKCdyb29tTmFtZScpLmVxdWFsVG8ocmVzcC5kYXRhKS5vbmNlKCd2YWx1ZScsIHNuYXBzaG90ID0+IHsKICAgICAgICAgIGlmIChzbmFwc2hvdC5leGlzdHMoKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnUm9vbSBFeGlzdHMnKTsKICAgICAgICAgICAgc25hcHNob3QuZm9yRWFjaCgoZG9jKSA9PiB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZG9jLmtleSk7CiAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICdDaGF0JywgcGFyYW1zOiB7bmlja25hbWU6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VybmFtZScpLCByb29taWQ6IGRvYy5rZXksIHJvb21uYW1lOiByZXNwLmRhdGEsIGZyaWVuZDogZnJpZW5kTmFtZX19KTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBidWcgcmVkaXJlY3QgaGltIHRvIG5ldyBwYWdlIHdoZW4gcm9vbSBjcmVhdGVkCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEb2VzIG5vdCBFeGlzdCIpCiAgICAgICAgICAgIGxldCBuZXdEYXRhID0gdGhpcy5yZWYucHVzaCgpCiAgICAgICAgICAgIG5ld0RhdGEuc2V0KHsKICAgICAgICAgICAgICByb29tTmFtZTogcmVzcC5kYXRhCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC8vIG5lZWQgdG8gcmVkaXJlY3QgdG8gY2hhdCBwYWdlCiAgICAgICAgICAgIC8vdGhpcy4kcm91dGVyLnB1c2goe25hbWU6ICdDaGF0JywgcGFyYW1zOiB7bmlja25hbWU6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VybmFtZScpLCByb29taWQ6IGRvYy5rZXksIHJvb21uYW1lOiByZXNwLmRhdGEsIGZyaWVuZDogZnJpZW5kTmFtZX19KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSkKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICBpZiAoIXRoaXMudXNlcm5hbWUpIHsKICAgICAgY29uc29sZS5sb2coInVlcm5hbWUgbm90IHByZXNudCIpOwogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2xvZ2luJykKICAgIH0KICAgIGVsc2UgewogICAgICBjb25zb2xlLmxvZygidWVybmFtZSBpcyBwcmVzbnQiKTsKICAgICAgdGhpcy5saXN0RnJpZW5kcygpOwogICAgfQogIH0KfQo="},{"version":3,"sources":["ListFriends.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ListFriends.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <b-container>\n    <b-row>\n      <b-col class=\"pt-5\">\n        <b-list-group class=\"list-group\">\n          <b-list-group-item class=\"d-flex justify-content-around\" v-for=\"item in users\" v-bind:key=\"item.id\">\n            <div class=\"col-4\" v-if=\"item.name === null\">\n              {{item.email}}\n            </div>\n            <div class=\"col-4\" v-else>\n              {{item.name}}\n            </div>\n\n            <div class=\"col-4 text-center\" >\n              <img class=\"img\"  thumbnail v-bind:src=\"item.picture\" alt=\"avatar\">\n            </div>\n            <div class=\"col-4 text-right\">\n              <button class=\"btn btn-primary pull-right\" @click=\"fetchRoom(item.id, item.name || item.email)\">Chat</button>\n            </div>\n          </b-list-group-item>\n        </b-list-group>\n      </b-col>\n    </b-row>\n  </b-container>\n</template>\n\n<script>\nimport axios from 'axios';\nimport {API_BASE_URL} from '/src/config.js';\nimport firebase from \"../firebase\";\n\nexport default {\n  name: \"ListFriends\",\n  data() {\n    return {\n      users: [],\n      email: '',\n      username: localStorage.getItem('username'),\n      ref: firebase.database().ref('chatrooms/')\n    }\n  },\n  methods: {\n    listFriends(){\n      axios.get(`${API_BASE_URL}private/listFriends`,{'headers' :{\n          'Authorization': 'Bearer '+localStorage.getItem('idToken'),\n        }}).then(resp => {\n        console.log(resp.data);\n        if(resp.status === 200){\n          this.users = resp.data;\n        }\n      }).catch(err => console.log(err))\n    },\n    fetchRoom(id, friendName) {\n      console.log(id);\n      axios.get(`${API_BASE_URL}private/getRoomName?friendId=${id}`, {'headers':{\n          'Authorization': 'Bearer '+localStorage.getItem('idToken'),\n      }}).then(resp => {\n        console.log(resp.data);\n        this.ref.orderByChild('roomName').equalTo(resp.data).once('value', snapshot => {\n          if (snapshot.exists()) {\n            console.log('Room Exists');\n            snapshot.forEach((doc) => {\n              console.log(doc.key);\n              this.$router.push({name: 'Chat', params: {nickname: localStorage.getItem('username'), roomid: doc.key, roomname: resp.data, friend: friendName}});\n              return true;\n            })\n          }\n          else {\n            // bug redirect him to new page when room created\n            console.log(\"Does not Exist\")\n            let newData = this.ref.push()\n            newData.set({\n              roomName: resp.data\n            })\n            // need to redirect to chat page\n            //this.$router.push({name: 'Chat', params: {nickname: localStorage.getItem('username'), roomid: doc.key, roomname: resp.data, friend: friendName}});\n          }\n        })\n      }).catch(err => console.log(err))\n    }\n  },\n  mounted() {\n    if (!this.username) {\n      console.log(\"uername not presnt\");\n      this.$router.push('/login')\n    }\n    else {\n      console.log(\"uername is presnt\");\n      this.listFriends();\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n.img{\n  max-width: 70px;\n  max-height: 70px;\n}\n</style>\n"]}]}